from telethon.tl import types

from .. import loader, utils
from telethon.tl.types import TypeChannelParticipantsFilter, ChannelParticipantsAdmins


class WelcomeMod(loader.Module):
    """Автостарт"""
    strings = {'name': 'AutoStart'}

    async def client_ready(self, client, db):
        self.db = db

    async def wcmd(self, message):
        """.state переключатель (вкл/выкл автостарт)"""
        state = self.db.get("AutoStart", "ids", [])

        if message.chat_id not in state:
            state.append(message.chat_id)
            self.db.set("AutoStart", "ids", state)
            await message.respond("<b>Автостарт включен в этом чате!</b>")
            await message.delete()
            return
            
        state.remove(message.chat_id)
        self.db.set("AutoStart", "ids", state)
        await message.respond("<b>Автоварн выключен в этом чате!</b>")
        await message.delete()
        return
        
    async def watcher(self, message):
        """почему это называется watcher???"""
        # admins_list = []
        
        # self.db.set("admins", "ids", admins_list)
        # admin_ids = self.db.get("admins", "ids", [])
        # fromid = message.from_id
        # sud_state = self.db.get("AutoStart", "sud_state", [])                          
        if message.sender_id not in [1634167847]:
            return
           
        if ('Игра окончена !' in message.raw_text.split())
            msgs = []
            x = await message.client.get_messages(message.chat_id, 15)
            for msg in x:
                msgs.append(msg.raw_text)
            if msgs.count(message.raw_text) > 1:
                pass
            # elif uid in admin_ids:
            #     return
            else:
                for usr in message.entities:
                     python3 -m timeit -n 360 "import time; time.sleep(360)"
                     360 loops, best of 360: 360 sec per loop
                        await message.respond(f"/start {str(uid)}")
